<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factory Events Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <h1><span class="brand-icon">âš¡</span> Factory<span style="color:var(--primary)">Pulse</span></h1>
            <div id="clock">--:--:--</div>
        </header>

        <!-- Simulator Bar -->
        <div class="simulator-bar">
            <div class="sim-info">
                <h2>Data Simulator</h2>
                <p>Generate 100 random events for analysis.</p>
            </div>
            <div style="display: flex; align-items: center;">
                <span id="sim-status">Ready to inject</span>
                <button id="btn-simulate" onclick="simulateBatch()" style="margin-left: 1rem;">
                    <span>ðŸš€</span> Inject Batch
                </button>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Sidebar / Controls -->
            <div class="card">
                <div class="card-header">
                    <h3>Filter Controls</h3>
                </div>

                <div class="control-group">
                    <label>Machine ID</label>
                    <input type="text" id="machineId" value="M-001">
                </div>

                <div class="control-group">
                    <label>Start Time</label>
                    <input type="datetime-local" id="startTime">
                </div>

                <div class="control-group">
                    <label>End Time</label>
                    <input type="datetime-local" id="endTime">
                </div>

                <button class="btn-secondary" onclick="fetchStats()">Apply Filters</button>

                <div class="card-header"
                    style="margin-top: 2rem; border-top: 1px solid var(--glass-border); padding-top: 1rem;">
                    <h3>Single Machine Status</h3>
                </div>

                <div id="stats-display" class="hidden">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <span id="stat-status" class="status-badge">--</span>
                    </div>

                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <span class="kpi-value" id="stat-events">0</span>
                            <span class="kpi-label">Total Events</span>
                        </div>
                        <div class="kpi-card">
                            <span class="kpi-value" id="stat-defects" style="color: var(--danger)">0</span>
                            <span class="kpi-label">Defects</span>
                        </div>
                        <div class="kpi-card" style="grid-column: span 2">
                            <span class="kpi-value" id="stat-rate">0.00</span>
                            <span class="kpi-label">Defects / Hour</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content / Top Defects -->
            <div class="card">
                <div class="card-header">
                    <h3>Top Defect Lines (Factory View)</h3>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <label style="font-size: 0.8rem; color: var(--text-muted)">Lookback (H):</label>
                        <input type="number" id="lookback" value="12" style="width: 60px; padding: 0.4rem;">
                        <button class="btn-secondary" style="width: auto; margin:0;"
                            onclick="fetchTopDefects()">â†»</button>
                    </div>
                </div>

                <div id="defect-list" class="defect-list">
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading data...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>